<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Creating a Lapis Application with Lua - Lapis Reference Manual</title>
  <link rel="stylesheet" href="../reference.css?Wed Jan  4 22:57:37 2023" />
  <script type="text/javascript">
  if (window.location.hostname != "localhost") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-136625-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  }
</script>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
</head>
<body>
  <div class="header">
    <button class="toggle_nav_btn" id="menu_toggle">Menu</button>
    <h1>
      <a href="..">Lapis</a>
    </h1>
    <div id="search_drop" data-root=".." data-index="../reference.json"></div>
    <a href="../changelog.html" class="version_flag">
      v1.11.0
    </a>
  </div>

  <div class="columns">
    <div class="nav_column">
      <div class="scrolling_inner">
        <div class="lang_picker">
          <span class="lang_toggle active" data-lang="lua">Lua</span>
          <span class="lang_toggle" data-lang="moonscript">MoonScript</span>
        </div>

        
          <div class="nav_links">
            <h2>Creating a Lapis Application with Lua</h2>
            <ul><li><a href="#generating-a-new-project">Generating a New Project</a></li>
<li><a href="#creating-a-view">Creating a View</a></li>
<ul><li><a href="#creating-a-view/working-with-etlua">Working with <code>etlua</code></a></li>
<li><a href="#creating-a-view/creating-a-layout">Creating a Layout</a></li></ul>
<li><a href="#next">Next</a></li></ul>
          </div>
        

        <div class="nav_links">
          <h2>All Guides</h2>

<ul>
<li><a href="../reference/getting_started.html">Getting Started</a>

<ul>
<li><a href="../reference/lua_getting_started.html">Getting Started With Lua</a></li>
<li><a href="../reference/moon_getting_started.html">Getting Started With MoonScript</a></li>
</ul>
</li>
<li><a href="../reference/actions.html">Requests and Actions</a></li>
<li><a href="../reference/configuration.html">Writing Configurations</a>

<ul>
<li><a href="../reference/lua_creating_configurations.html">Lua configuration syntax</a></li>
<li><a href="../reference/moon_creating_configurations.html">MoonScript configuration syntax</a></li>
</ul>
</li>
<li><a href="../reference/database.html">Database Access, and Queries</a>

<ul>
<li><a href="../reference/models.html">Models</a></li>
</ul>
</li>
<li><a href="../reference/exception_handling.html">Handling Exceptions</a></li>
<li><a href="../reference/input_validation.html">Input Validation</a></li>
<li><a href="../reference/html_generation.html">HTML Generation</a></li>
<li><a href="../reference/etlua_templates.html">etlua Templates</a></li>
<li><a href="../reference/testing.html">Testing</a></li>
<li><a href="../reference/utilities.html">Utility Functions</a></li>
<li><a href="../reference/command_line.html">Command Line Tool</a></li>
<li><a href="../reference/lapis_console.html">Lapis Console</a></li>
</ul>


        </div>

      </div>
    </div>

    <div class="nav_offset">
      <div class="text_column"><div class="override_lang" data-lang="lua"></div>


<h1>Creating a Lapis Application with Lua</h1>

<h2><a name="generating-a-new-project" href="#generating-a-new-project">Generating a New Project</a></h2>

<p>If you haven&rsquo;t already, read through the <a href="getting_started.html">generic getting started guide</a> for
information on creating a new project skeleton along with details on OpenResty,
Nginx configurations, and the <code>lapis</code> command.</p>

<p>You can start a new Lua project in the current directory by running the
following command:</p>

<pre class="highlight lang_bash"><code><span class="sh_default">$</span><span class="sh_bash_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_bash_whitespace sh_whitespace"> </span><span class="sh_identifier">new</span><span class="sh_bash_whitespace sh_whitespace"> </span><span class="sh_operator">--</span><span class="sh_identifier">lua</span></code>
</pre>


<p>The default <code>nginx.conf</code> reads a file called <code>app.lua</code> for your application. A
basic one is provided with the <code>lapis new</code> command.</p>

<p><code>app.lua</code> is a regular Lua module that contains the application. You can even
require the module like any other in the regular Lua interpreter. It looks like
this:</p>

<pre class="highlight lang_lua"><code><span class="sh_comment">-- app.lua</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">get</span><span class="sh_operator">(</span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Welcome to Lapis &quot;</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">..</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.version&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span></code>
</pre>


<p>Try it out by starting the server:</p>

<pre class="highlight lang_bash"><code><span class="sh_identifier">lapis</span><span class="sh_bash_whitespace sh_whitespace"> </span><span class="sh_identifier">server</span></code>
</pre>


<p>Visit <a href="http://localhost:8080">http://localhost:8080</a> to see the page.</p>

<p>To change the port we can create a configuration. Create <code>config.lua</code>.</p>

<p>In this example we change the port in the <code>development</code> environment to 9090:</p>

<pre class="highlight lang_lua"><code><span class="sh_comment">-- config.lua</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">config</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.config&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">config</span><span class="sh_operator">(</span><span class="sh_string">&quot;development&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">port</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_number">9090</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">})</span></code>
</pre>


<blockquote><p>You can read more about configurations on the <a href="configuration.html">Configurations and
Environments guide</a>.</p></blockquote>

<p>The <code>development</code> environment is used and loaded automatically when <code>lapis
server</code> is run with no additional arguments. (And the file
<code>lapis_environment.lua</code> doesn&rsquo;t exist)</p>

<p>Lapis uses a handful of fields in the configuration (such as <code>port</code>), other
fields can be used to store anything you want. For example:</p>

<pre class="highlight lang_lua"><code><span class="sh_comment">-- config.lua</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">config</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.config&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">config</span><span class="sh_operator">(</span><span class="sh_string">&quot;development&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">greeting</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello world&quot;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">})</span></code>
</pre>


<p>You can get the current configuration by calling <code>get</code>. It returns a plain Lua
table:</p>

<pre class="highlight lang_lua"><code><span class="sh_comment">-- app.lua</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">config</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.config&quot;</span><span class="sh_operator">).</span><span class="sh_identifier">get</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">get</span><span class="sh_operator">(</span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">(</span><span class="sh_identifier">self</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">config</span><span class="sh_operator">.</span><span class="sh_identifier">greeting</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">..</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot; from port &quot;</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">..</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">config</span><span class="sh_operator">.</span><span class="sh_identifier">port</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span></code>
</pre>


<h2><a name="creating-a-view" href="#creating-a-view">Creating a View</a></h2>

<p>Now that we can create basic pages we'll likely want to render something a bit
more complex. Lapis comes with support for <a href="https://github.com/leafo/etlua">etlua</a>, a Lua templating
language that lets you insert Lua mixed in with text and HTML.</p>

<p>A view is a file that is responsible for generating the HTML. Typically your
action will prepare all the data for your view and then tell it to render.</p>

<p>By default Lapis searches for views in <code>views/</code> directory. Lets create a new
view there, <code>index.etlua</code>. We won&rsquo;t use any of etlua&rsquo;s special markup just yet,
so it will look like a normal HTML file.</p>

<pre class="highlight lang_html"><code><span class="sh_comment">&lt;!-- views/index.etlua --&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;h1&gt;</span><span class="sh_default">Hello</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_default">world</span><span class="sh_element sh_keyword">&lt;/h1&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;p&gt;</span><span class="sh_default">Welcome</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_default">to</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_default">my</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_default">page</span><span class="sh_element sh_keyword">&lt;/p&gt;</span></code>
</pre>


<p>You'll notice that <code>&lt;html&gt;</code>, <code>&lt;head&gt;</code>, and <code>&lt;body&gt;</code> tags aren&rsquo;t there. The view
typically renders the inside of the page, and the layout is responsible for
what goes around it. We'll look at layouts further down.</p>

<p>Now lets create the application which renders our view:</p>

<pre class="highlight lang_lua"><code><span class="sh_comment">-- app.lua</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">enable</span><span class="sh_operator">(</span><span class="sh_string">&quot;etlua&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">get</span><span class="sh_operator">(</span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">(</span><span class="sh_identifier">self</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">render</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;index&quot;</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span></code>
</pre>


<p><code>etlua</code> is not enabled by default, you must enable it by calling the <code>enable</code>
method on your application instance.</p>

<p>We use the <code>render</code> parameter of our action&rsquo;s return value to instruct what
template to use when rendering the page. In this case <code>"index"</code> refers to the
module with the name <code>views.index</code>. <code>etalua</code> injects itself into Lua&rsquo;s
<code>require</code> method and so when the module <code>views.index</code> is loaded, an attempt to
read and parse the file <code>views/index.etlua</code> is made.</p>

<p>Running the server and navigating to it in the browser should show our rendered
template.</p>

<h3><a name="creating-a-view/working-with-etlua" href="#creating-a-view/working-with-etlua">Working with <code>etlua</code></a></h3>

<p><code>etlua</code> comes with the following tags for injecting Lua into your templates:</p>

<ul>
<li><code>&lt;% lua_code %&gt;</code> runs Lua code verbatim</li>
<li><code>&lt;%= lua_expression %&gt;</code> writes result of expression to output, HTML escaped</li>
<li><code>&lt;%- lua_expression %&gt;</code> same as above but with no HTML escaping</li>
</ul>


<blockquote><p>Learn more about the etlua integration in the <a href="etlua_templates.html">etlua guide</a>.</p></blockquote>

<p>In the following example we assign some data in the action, then print it out
in our view:</p>

<pre class="highlight lang_lua"><code><span class="sh_comment">-- app.lua</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">enable</span><span class="sh_operator">(</span><span class="sh_string">&quot;etlua&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">get</span><span class="sh_operator">(</span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">(</span><span class="sh_identifier">self</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">self</span><span class="sh_operator">.</span><span class="sh_identifier">my_favorite_things</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_string">&quot;Cats&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_string">&quot;Horses&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_string">&quot;Skateboards&quot;</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">

  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">render</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;list&quot;</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span></code>
</pre>


<pre class="highlight lang_erb"><code><span class="sh_comment">&lt;!-- views/list.etlua --&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;h1&gt;</span><span class="sh_default">Here</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_default">are</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_default">my</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_default">favorite</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_default">things</span><span class="sh_element sh_keyword">&lt;/h1&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;ol&gt;</span><span class="sh_html_whitespace sh_whitespace">
  </span><span class="sh_rhtml_tag sh_embedded">&lt;%</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_keyword">for</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_identifier">i</span><span class="sh_operator">,</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_identifier">thing</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_keyword">in</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_identifier">pairs</span><span class="sh_operator">(</span><span class="sh_identifier">my_favorite_things</span><span class="sh_operator">)</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_keyword">do</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_rhtml_tag sh_embedded">%&gt;</span><span class="sh_html_whitespace sh_whitespace">
    </span><span class="sh_element sh_keyword">&lt;li&gt;</span><span class="sh_rhtml_tag sh_embedded">&lt;%=</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_identifier">thing</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_rhtml_tag sh_embedded">%&gt;</span><span class="sh_element sh_keyword">&lt;/li&gt;</span><span class="sh_html_whitespace sh_whitespace">
  </span><span class="sh_rhtml_tag sh_embedded">&lt;%</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_keyword">end</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_rhtml_tag sh_embedded">%&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;/ol&gt;</span></code>
</pre>


<h3><a name="creating-a-view/creating-a-layout" href="#creating-a-view/creating-a-layout">Creating a Layout</a></h3>

<p>A layout is a separate shared template that wraps the content of every page.
Lapis comes with a basic layout to get you started but you'll most likely want
to replace it with something custom.</p>

<p>We'll write the layout in etlua just like our views. Create <code>views/layout.etlua</code>:</p>

<pre class="highlight lang_erb"><code><span class="sh_comment">&lt;!-- views/layout.etlua --&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_doctype sh_comment">&lt;!DOCTYPE HTML&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;html</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_attribute sh_type">lang</span><span class="sh_default">=</span><span class="sh_string">&quot;en&quot;</span><span class="sh_element sh_keyword">&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;head&gt;</span><span class="sh_html_whitespace sh_whitespace">
  </span><span class="sh_single_element sh_keyword">&lt;meta</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_attribute sh_type">charset</span><span class="sh_default">=</span><span class="sh_string">&quot;UTF-8&quot;</span><span class="sh_element sh_keyword">&gt;</span><span class="sh_html_whitespace sh_whitespace">
  </span><span class="sh_element sh_keyword">&lt;title&gt;</span><span class="sh_rhtml_tag sh_embedded">&lt;%=</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_identifier">page_title</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_keyword">or</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_string">&quot;My Page&quot;</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_rhtml_tag sh_embedded">%&gt;</span><span class="sh_element sh_keyword">&lt;/title&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;/head&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;body&gt;</span><span class="sh_html_whitespace sh_whitespace">
  </span><span class="sh_element sh_keyword">&lt;h1&gt;</span><span class="sh_default">Greetings</span><span class="sh_element sh_keyword">&lt;/h1&gt;</span><span class="sh_html_whitespace sh_whitespace">
  </span><span class="sh_rhtml_tag sh_embedded">&lt;%</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_function">content_for</span><span class="sh_operator">(</span><span class="sh_string">&quot;inner&quot;</span><span class="sh_operator">)</span><span class="sh_ruby_whitespace sh_whitespace"> </span><span class="sh_rhtml_tag sh_embedded">%&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;/body&gt;</span><span class="sh_html_whitespace sh_whitespace">
</span><span class="sh_element sh_keyword">&lt;/html&gt;</span></code>
</pre>


<p>The <code>content_for</code> function is a special function built into templates that
allows you to send data from a view to a layout. Lapis puts the rendered result
of the view into the content variable named <code>inner</code>. You'll note that we don&rsquo;t
need to use any of the etlua tags that write into the page. This is because
<code>content_for</code> efficiently puts its result directly into the output buffer.</p>

<p>Any other variables and helper functions that would normally be available in a
view are also available in the layout.</p>

<p>Now that the layout is written it can be assigned to the application:</p>

<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">enable</span><span class="sh_operator">(</span><span class="sh_string">&quot;etlua&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">app</span><span class="sh_operator">.</span><span class="sh_identifier">layout</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;views.layout&quot;</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_comment">-- the rest of the application...</span></code>
</pre>


<p>The syntax is slightly different than rendering a view. Instead of assigning a
template name to the <code>layout</code> field, we assign the actual template object. This
can be obtained by just requiring it by the module name: <code>"views.layout"</code>. As
described above, etlua takes care of converting the <code>.etlua</code> file into something
usable by Lua.</p>

<h2><a name="next" href="#next">Next</a></h2>

<p>Read the <a href="../reference/actions.html">Requests and Actions guide</a> next to learn how Lapis routes HTTP
requests and lets you respond to them.</p>

      </div>
    </div>

  </div>

  <script src="../lib/jquery.min.js"></script>
  <script src="../lib/react.production.min.js"></script>
  <script src="../lib/react-dom.production.min.js"></script>
  <script src="../lib/react-dom-factories.js"></script>
  <script src="../lib/lunr.min.js"></script>
  <script type="text/javascript" src="../search.js?Wed Jan  4 22:57:37 2023"></script>
  <script type="text/javascript" src="../reference.js?Wed Jan  4 22:57:37 2023"></script>
  <script type="text/javascript">
    new L.Reference();
  </script>
</body>
</html>
