<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HTML Generation - Lapis Reference Manual</title>
  <link rel="stylesheet" href="../reference.css?Wed Jan  4 22:57:36 2023" />
  <script type="text/javascript">
  if (window.location.hostname != "localhost") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-136625-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  }
</script>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
</head>
<body>
  <div class="header">
    <button class="toggle_nav_btn" id="menu_toggle">Menu</button>
    <h1>
      <a href="..">Lapis</a>
    </h1>
    <div id="search_drop" data-root=".." data-index="../reference.json"></div>
    <a href="../changelog.html" class="version_flag">
      v1.11.0
    </a>
  </div>

  <div class="columns">
    <div class="nav_column">
      <div class="scrolling_inner">
        <div class="lang_picker">
          <span class="lang_toggle active" data-lang="lua">Lua</span>
          <span class="lang_toggle" data-lang="moonscript">MoonScript</span>
        </div>

        
          <div class="nav_links">
            <h2>HTML Generation</h2>
            <ul><li><a href="#html-builder-syntax">HTML Builder Syntax</a></li>
<ul><li><a href="#html-builder-syntax/special-attributes">Special attributes</a></li>
<li><a href="#html-builder-syntax/helper-functions">Helper functions</a></li></ul>
<li><a href="#html-in-actions">HTML In Actions</a></li>
<li><a href="#html-widgets">HTML Widgets</a></li>
<ul><li><a href="#html-widgets/rendering-a-widget-from-an-action">Rendering A Widget From An Action</a></li>
<li><a href="#html-widgets/passing-data-to-a-widget">Passing Data To A Widget</a></li>
<li><a href="#html-widgets/rendering-widgets-manually">Rendering Widgets Manually</a></li></ul>
<li><a href="#layouts">Layouts</a></li>
<li><a href="#widget-methods">Widget Methods</a></li>
<ul><li><a href="#widget-methods/Widget:extend"><code>Widget:extend([name], fields={}, [setup_fn])</code></a></li>
<li><a href="#widget-methods/Widget"><code>Widget([opts])</code></a></li>
<li><a href="#widget-methods/Widget:include"><code>Widget:include(other_class)</code></a></li>
<li><a href="#widget-methods/widget:render_to_string"><code>widget:render_to_string()</code></a></li>
<li><a href="#widget-methods/widget:render"><code>widget:render(buffer, ...)</code></a></li>
<li><a href="#widget-methods/widget:content_for"><code>widget:content_for(name, [content])</code></a></li>
<li><a href="#widget-methods/widget:has_content_for"><code>widget:has_content_for(name)</code></a></li></ul>
<li><a href="#html-module">HTML Module</a></li>
<ul><li><a href="#html-module/html.Widget"><code>html.Widget</code></a></li>
<li><a href="#html-module/html.render_html"><code>html.render_html(fn)</code></a></li>
<li><a href="#html-module/html.escape"><code>html.escape(str)</code></a></li>
<li><a href="#html-module/html.classnames"><code>html.classnames(t)</code></a></li>
<li><a href="#html-module/html.is_mixins_class"><code>html.is_mixins_class(obj)</code></a></li></ul></ul>
          </div>
        

        <div class="nav_links">
          <h2>All Guides</h2>

<ul>
<li><a href="../reference/getting_started.html">Getting Started</a>

<ul>
<li><a href="../reference/lua_getting_started.html">Getting Started With Lua</a></li>
<li><a href="../reference/moon_getting_started.html">Getting Started With MoonScript</a></li>
</ul>
</li>
<li><a href="../reference/actions.html">Requests and Actions</a></li>
<li><a href="../reference/configuration.html">Writing Configurations</a>

<ul>
<li><a href="../reference/lua_creating_configurations.html">Lua configuration syntax</a></li>
<li><a href="../reference/moon_creating_configurations.html">MoonScript configuration syntax</a></li>
</ul>
</li>
<li><a href="../reference/database.html">Database Access, and Queries</a>

<ul>
<li><a href="../reference/models.html">Models</a></li>
</ul>
</li>
<li><a href="../reference/exception_handling.html">Handling Exceptions</a></li>
<li><a href="../reference/input_validation.html">Input Validation</a></li>
<li><a href="../reference/html_generation.html">HTML Generation</a></li>
<li><a href="../reference/etlua_templates.html">etlua Templates</a></li>
<li><a href="../reference/testing.html">Testing</a></li>
<li><a href="../reference/utilities.html">Utility Functions</a></li>
<li><a href="../reference/command_line.html">Command Line Tool</a></li>
<li><a href="../reference/lapis_console.html">Lapis Console</a></li>
</ul>


        </div>

      </div>
    </div>

    <div class="nav_offset">
      <div class="text_column"><h1>HTML Generation</h1>

<p>This guide is focused on using builder syntax in Lua/MoonScript to generate
HTML. If you're interested in a more traditional templating system see the
<a href="../reference/etlua_templates.html">etlua Templates guide</a>.
This mechanism for generating HTML code is mainly intended to be used with
Moonscript, but it can also be used in Lua code.</p>

<h2><a name="html-builder-syntax" href="#html-builder-syntax">HTML Builder Syntax</a></h2>

<p>HTML templates can be written directly as MoonScript (or Lua) code. This is a
very powerful feature (inspired by <a href="http://erector.rubyforge.org/">Erector</a>)
that gives us the ability to write templates with high composability and also
all the features of MoonScript or Lua. No need to learn a separate templating
language, you can use the full power of the language you're already using.</p>

<p>In the context of a HTML renderer, the environment exposes functions that
create HTML tags. The tag builder functions are generated on the fly as you
call them via a custom function environment. The output of these functions is
written into a buffer that is compiled in the end and returned as the result</p>

<p>Here are some examples of the HTML generation:</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_identifier">div</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">                     </span><span class="sh_comment">-- &lt;div&gt;&lt;/div&gt;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">b</span><span class="sh_operator">(</span><span class="sh_string">&quot;Hello World&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">          </span><span class="sh_comment">-- &lt;b&gt;Hello World&lt;/b&gt;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">div</span><span class="sh_operator">(</span><span class="sh_string">&quot;hi&lt;br/&gt;&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">            </span><span class="sh_comment">-- &lt;div&gt;hi&amp;lt;br/&amp;gt;&lt;/div&gt;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">text</span><span class="sh_operator">(</span><span class="sh_string">&quot;Hi!&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">               </span><span class="sh_comment">-- Hi!</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">raw</span><span class="sh_operator">(</span><span class="sh_string">&quot;&lt;br/&gt;&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">              </span><span class="sh_comment">-- &lt;br/&gt;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">br</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">                      </span><span class="sh_comment">-- &lt;br/&gt;</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">element</span><span class="sh_operator">(</span><span class="sh_string">&quot;table&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">width</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;100%&quot;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">})</span><span class="sh_lua_whitespace sh_whitespace">                        </span><span class="sh_comment">-- &lt;table width=&quot;100%&quot;&gt;&lt;/table&gt;</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">div</span><span class="sh_operator">({</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;footer&quot;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;The Foot&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">            </span><span class="sh_comment">-- &lt;div class=&quot;footer&quot;&gt;The Foot&lt;/div&gt;</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">input</span><span class="sh_operator">({</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">required</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">})</span><span class="sh_lua_whitespace sh_whitespace">                        </span><span class="sh_comment">-- &lt;input required /&gt;</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">div</span><span class="sh_operator">(</span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">text</span><span class="sh_operator">(</span><span class="sh_string">&quot;Hey&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">                      </span><span class="sh_comment">-- &lt;div&gt;Hey&lt;/div&gt;</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">div</span><span class="sh_operator">({</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;header&quot;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">h2</span><span class="sh_operator">(</span><span class="sh_string">&quot;My Site&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">p</span><span class="sh_operator">(</span><span class="sh_string">&quot;Welcome!&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">                      </span><span class="sh_comment">-- &lt;div class=&quot;header&quot;&gt;&lt;h2&gt;My Site&lt;/h2&gt;</span><span class="sh_lua_whitespace sh_whitespace">
                          </span><span class="sh_comment">--    &lt;p&gt;Welcome!&lt;/p&gt;&lt;/div&gt;</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_identifier">div</span><span class="sh_operator">!</span><span class="sh_moonscript_whitespace sh_whitespace">                </span><span class="sh_comment">-- &lt;div&gt;&lt;/div&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_identifier">b</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello World&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">     </span><span class="sh_comment">-- &lt;b&gt;Hello World&lt;/b&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;hi&lt;br/&gt;&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">       </span><span class="sh_comment">-- &lt;div&gt;hi&amp;lt;br/&amp;gt;&lt;/div&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_identifier">text</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hi!&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">          </span><span class="sh_comment">-- Hi!</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_identifier">raw</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;&lt;br/&gt;&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">         </span><span class="sh_comment">-- &lt;br/&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_identifier">element</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;table&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">width:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;100%&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">  </span><span class="sh_comment">-- &lt;table width=&quot;100%&quot;&gt;&lt;/table&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;footer&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;The Foot&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">     </span><span class="sh_comment">-- &lt;div class=&quot;footer&quot;&gt;The Foot&lt;/div&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_identifier">input</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">required:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span><span class="sh_moonscript_whitespace sh_whitespace">                </span><span class="sh_comment">-- &lt;input required/&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">                              </span><span class="sh_comment">-- &lt;div&gt;Hey&lt;/div&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_identifier">text</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hey&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;header&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">             </span><span class="sh_comment">-- &lt;div class=&quot;header&quot;&gt;&lt;h2&gt;My Site&lt;/h2&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_identifier">h2</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;My Site&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">                      </span><span class="sh_comment">--    &lt;p&gt;Welcome!&lt;/p&gt;&lt;/div&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_library sh_type">p</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Welcome!&quot;</span></code>
</pre>
</div>

</p>

<p>The <code>element</code> function is a special builder that takes the name of tag to
generate as the first argument followed by any attributes and content.</p>

<p>The HTML builder methods have lower precedence than any existing variables, so
if you have a variable named <code>div</code> and you want to make a <code>&lt;div&gt;</code> tag you'll
need to call <code>element "div"</code>.</p>

<blockquote><p>If you want to create a <code>&lt;table&gt;</code> or <code>&lt;select&gt;</code> tag you'll need to use
<code>element</code> because Lua uses those names in the built-in modules.</p></blockquote>

<p>All strings passed to the HTML builder functions (attribute names, values, or
tag contents) are escaped automatically. You never have to worry about
introducing any cross site scripting vulnerabilities.</p>

<h3><a name="html-builder-syntax/special-attributes" href="#html-builder-syntax/special-attributes">Special attributes</a></h3>

<p>The <code>class</code> attribute can be passed as a table, and the class list will be
constructed from it. The table can contain either array element, or hash
elements:</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_identifier">div</span><span class="sh_operator">({</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_string">&quot;one&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_string">&quot;two&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">three</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">false</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">four</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello world!&quot;</span><span class="sh_operator">)</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_symbol sh_embedded">{</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_symbol sh_embedded">{</span><span class="sh_string">&quot;one&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;two&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">three:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">false</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">four:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span><span class="sh_symbol sh_embedded">}</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_symbol sh_embedded">}</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello world!&quot;</span></code>
</pre>
</div>

</p>

<p>Will generate:</p>

<pre class="highlight lang_html"><code><span class="sh_element sh_keyword">&lt;div</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_attribute sh_type">class</span><span class="sh_default">=</span><span class="sh_string">&quot;one two four&quot;</span><span class="sh_element sh_keyword">&gt;</span><span class="sh_default">Hello</span><span class="sh_html_whitespace sh_whitespace"> </span><span class="sh_default">world!</span><span class="sh_element sh_keyword">&lt;/div&gt;</span></code>
</pre>


<p>This conversion is done by the <code>html.classnames</code> function described below.</p>

<h3><a name="html-builder-syntax/helper-functions" href="#html-builder-syntax/helper-functions">Helper functions</a></h3>

<p>In the scope of a HTML builder function, in addition to the auto generated
functions for writing HTML tags, the following functions are also available:</p>

<ul>
<li><code>raw(str)</code> &mdash; outputs the argument, a string, directly to the buffer without escaping.</li>
<li><code>capture(func)</code> &mdash; executes the function argument in the context of the HTML builder environment, returns the compiled result as a string instead of writing to buffer.</li>
<li><code>text(args)</code> &mdash; outputs the argument to the buffer, escaping it if it&rsquo;s a string. If it&rsquo;s a function, it executes the function in HTML builder environment. If it&rsquo;s a table, it writes each item in the table</li>
<li><code>widget(some_widget)</code> &mdash; renders another widget in the current output buffer. Automatically passes the enclosing context. The widget can either be an instance of a widget, or a widget class. If a class is provided, then an instance with no arguments is created.</li>
<li><code>render(template_name)</code> &mdash; renders another widget or view by the module name. Lets you render etlua templates from inside builder</li>
</ul>


<h2><a name="html-in-actions" href="#html-in-actions">HTML In Actions</a></h2>

<p>If we want to generate HTML directly in our action we can use the
<code class="for_moon">@html</code><code class="for_lua">self.html</code> method:</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">MyApp</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">MyApp</span><span class="sh_operator">:</span><span class="sh_identifier">match</span><span class="sh_operator">(</span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">(</span><span class="sh_identifier">self</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">self</span><span class="sh_operator">:</span><span class="sh_identifier">html</span><span class="sh_operator">(</span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">h1</span><span class="sh_operator">({</span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;header&quot;</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">div</span><span class="sh_operator">({</span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;body&quot;</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
      </span><span class="sh_identifier">text</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Welcome to my site!&quot;</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">MyApp</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Application</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_self_ref sh_label">@html</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_identifier">h1</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;header&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;body&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
        </span><span class="sh_identifier">text</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Welcome to my site!&quot;</span></code>
</pre>
</div>

</p>

<p>The environment of the function passed to <code class="for_moon">@html</code><code class="for_lua">self.html</code> is set to one that
support the HTML builder functions described above. The return value of the
<code class="for_moon">@html</code><code class="for_lua">self.html</code> method is the generated HTML as a string. Returning this from
the action allows us to render send it right to the browser</p>

<h2><a name="html-widgets" href="#html-widgets">HTML Widgets</a></h2>

<p>The preferred way to write HTML is through widgets. Widgets are classes who are
only concerned with outputting HTML. Each method in the widget is executed in
the HTML builder scope that allows you to use the syntax described above to
write HTML to the response buffer.</p>

<p>When Lapis loads a widget automatically it does it by package name. For
example, if it was loading the widget for the name <code>"index"</code> it would try to
load the module <code>views.index</code>, and the result of that module should be the
widget.</p>

<p>This is what a widget looks like:</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_comment">-- views/index.lua</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Widget</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_operator">).</span><span class="sh_identifier">Widget</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Index</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Index_mt</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Widget</span><span class="sh_operator">:</span><span class="sh_identifier">extend</span><span class="sh_operator">(</span><span class="sh_string">&quot;Index&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">function</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Index_mt</span><span class="sh_operator">:</span><span class="sh_identifier">content</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">h1</span><span class="sh_operator">({</span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;header&quot;</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">div</span><span class="sh_operator">({</span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;body&quot;</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">text</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Welcome to my site!&quot;</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Index</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_comment">-- views/index.moon</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_keyword">import</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">from</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Index</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">h1</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;header&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;body&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_identifier">text</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Welcome to my site!&quot;</span></code>
</pre>
</div>

</p>

<blockquote><p>The name of the widget class is insignificant, but it&rsquo;s worth making one
because some systems can auto-generate encapsulating HTML named after the
class.</p></blockquote>

<h3><a name="html-widgets/rendering-a-widget-from-an-action" href="#html-widgets/rendering-a-widget-from-an-action">Rendering A Widget From An Action</a></h3>

<p>The <code>render</code> option key is used to render a widget. For example you can render
the <code>"index"</code> widget from our action by returning a table with render set to
the name of the widget:</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">match</span><span class="sh_operator">(</span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_identifier">render</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;index&quot;</span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">render:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;index&quot;</span></code>
</pre>
</div>

</p>

<p>If the action has a name, then we can set render to <code>true</code> to load the widget
with the same name as the action:</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">match</span><span class="sh_operator">(</span><span class="sh_string">&quot;index&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_identifier">render</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;index&quot;</span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_symbol sh_embedded">[</span><span class="sh_tbl_key sh_regex">index:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;/&quot;</span><span class="sh_symbol sh_embedded">]</span><span class="sh_operator">:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">render:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span></code>
</pre>
</div>

</p>

<p>By default <code>views.</code> is prepended to the widget name and then loaded
using Lua&rsquo;s <code>require</code> function. The <code>views</code> prefix can be customized by
overwriting the <code>views_prefix</code> member of your application subclass:</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">app</span><span class="sh_operator">.</span><span class="sh_identifier">views_prefix</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;app_views&quot;</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">match</span><span class="sh_operator">(</span><span class="sh_string">&quot;home&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace"> 
  </span><span class="sh_comment">-- will load &quot;app_views.home&quot; as the view</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_identifier">render</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">match</span><span class="sh_operator">(</span><span class="sh_string">&quot;/profile&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace"> 
  </span><span class="sh_comment">-- will load &quot;app_views.profile&quot; as the view</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_identifier">render</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;profile&quot;</span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Application</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Application</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">views_prefix:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;app_views&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

  </span><span class="sh_comment">-- will use &quot;app_views.home&quot; as the view</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_symbol sh_embedded">[</span><span class="sh_tbl_key sh_regex">home:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;/home&quot;</span><span class="sh_symbol sh_embedded">]</span><span class="sh_operator">:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">render:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span></code>
</pre>
</div>

</p>

<h3><a name="html-widgets/passing-data-to-a-widget" href="#html-widgets/passing-data-to-a-widget">Passing Data To A Widget</a></h3>

<p>Any <code class="for_moon">@</code><code class="for_lua">self.</code> variables set in the action can be accessed in the widget. Additionally
any of the helper functions like <code class="for_moon">@url_for</code><code class="for_lua">self.url_for</code> are also accessible.</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_comment">-- app.lua</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">match</span><span class="sh_operator">(</span><span class="sh_string">&quot;index&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;/&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">self</span><span class="sh_operator">.</span><span class="sh_identifier">page_title</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Welcome To My Page&quot;</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_identifier">render</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace">  </span><span class="sh_keyword">true</span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_comment">-- app.moon</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">App</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Application</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_symbol sh_embedded">[</span><span class="sh_tbl_key sh_regex">index:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;/&quot;</span><span class="sh_symbol sh_embedded">]</span><span class="sh_operator">:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_self_ref sh_label">@page_title</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Welcome To My Page&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_tbl_key sh_regex">render:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span></code>
</pre>
</div>

</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Widget</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_operator">).</span><span class="sh_identifier">Widget</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Widget</span><span class="sh_operator">:</span><span class="sh_identifier">extend</span><span class="sh_operator">(</span><span class="sh_string">&quot;Index&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">content</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">(</span><span class="sh_identifier">self</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">h1</span><span class="sh_operator">({</span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;header&quot;</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">self</span><span class="sh_operator">.</span><span class="sh_identifier">page_title</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">div</span><span class="sh_operator">({</span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;body&quot;</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
      </span><span class="sh_identifier">text</span><span class="sh_operator">(</span><span class="sh_string">&quot;Welcome to my site!&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">end</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">})</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_comment">-- views/index.moon</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_keyword">import</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">from</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Index</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">h1</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;header&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_self_ref sh_label">@page_title</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;body&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_identifier">text</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Welcome to my site!&quot;</span></code>
</pre>
</div>

</p>

<h3><a name="html-widgets/rendering-widgets-manually" href="#html-widgets/rendering-widgets-manually">Rendering Widgets Manually</a></h3>

<p>Widgets can also be rendered manually by instantiating them and calling the
<code>render_to_string</code> method.</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Index</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;views.index&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">widget</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Index</span><span class="sh_operator">({</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">page_title</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello World&quot;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">})</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_function">print</span><span class="sh_operator">(</span><span class="sh_identifier">widget</span><span class="sh_operator">:</span><span class="sh_identifier">render_to_string</span><span class="sh_operator">())</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_proper_ident sh_class">Index</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;views.index&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_identifier">widget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Index</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">page_title:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello World&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_function">print</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">widget</span><span class="sh_operator">\</span><span class="sh_identifier">render_to_string</span><span class="sh_operator">!</span></code>
</pre>
</div>

</p>

<p>If you want to use helpers like <code class="for_moon">@url_for</code><code class="for_lua">self.url_for</code> you also need to include
them in the widget instance. Any object can be included as a helper, and its
methods will be made available inside of the widget.</p>

<pre class="highlight lang_moon"><code><span class="sh_identifier">html</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">SomeWidget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">html</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">a</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">href:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_self_ref sh_label">@url_for</span><span class="sh_symbol sh_embedded">(</span><span class="sh_string">&quot;test&quot;</span><span class="sh_symbol sh_embedded">)</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Test Page&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Application</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_symbol sh_embedded">[</span><span class="sh_tbl_key sh_regex">test:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;/test_render&quot;</span><span class="sh_symbol sh_embedded">]</span><span class="sh_operator">:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">widget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">SomeWidget</span><span class="sh_operator">!</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">widget</span><span class="sh_operator">\</span><span class="sh_identifier">include_helper</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_self_ref sh_label">@</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">widget</span><span class="sh_operator">\</span><span class="sh_identifier">render_to_string</span><span class="sh_operator">!</span></code>
</pre>


<p>You should avoid rendering widgets manually when possible. When in an action
use the <code>render</code> <a href="#request-object-request-options">request option</a>. When in
another widget use the <code>widget</code> helper function. Both of these methods will
ensure the same output buffer is shared to avoid unnecessary string
concatenations.</p>

<h2><a name="layouts" href="#layouts">Layouts</a></h2>

<p>Whenever an action is rendered normally the result is inserted into the
current layout. The layout is just another widget, but it is used across many
pages. Typically this is where you would put your <code>&lt;html&gt;</code> and <code>&lt;head&gt;</code> tags.</p>

<p>Lapis comes with a default layout that looks like this:</p>

<pre class="highlight lang_moon"><code><span class="sh_identifier">html</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">DefaultLayout</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">html</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">html_5</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_identifier">head</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">title</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_self_ref sh_label">@title</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">or</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Lapis Page&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_identifier">body</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_self_ref sh_label">@content_for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;inner&quot;</span></code>
</pre>


<p>Use this as a starting point for creating your own layout. The content of your
page will be injected in the location of the call to <code>@content_for "inner"</code>.</p>

<p>We can specify the layout for an entire application or specify it for a
specific action. For example, if we have our new layout in <code>views/my_layout.moon</code></p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">app</span><span class="sh_operator">.</span><span class="sh_identifier">layout</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;views.my_layout&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_comment">-- you can also write this, and it will prepend app.views_prefix</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_comment">-- app.layout = &quot;my_layout&quot;</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Application</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">layout:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;views.my_layout&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

  </span><span class="sh_comment">-- you can also write this, and it will prepend app.views_prefix</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_comment">-- layout: = &quot;my_layout&quot;</span></code>
</pre>
</div>

</p>

<p>If we want to set the layout for a specific action we can provide it as part of
the action&rsquo;s return value.</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">app</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_identifier">Application</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_comment">-- the following two have the same effect with the default views_prefix</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">match</span><span class="sh_operator">(</span><span class="sh_string">&quot;/home1&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">layout</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;my_layout&quot;</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">match</span><span class="sh_operator">(</span><span class="sh_string">&quot;/home2&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">layout</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;views.my_layout&quot;</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_comment">-- this doesn&#x27;t use a layout at all</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_identifier">app</span><span class="sh_operator">:</span><span class="sh_identifier">match</span><span class="sh_operator">(</span><span class="sh_string">&quot;/no_layout&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">layout</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">false</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;No layout rendered!&quot;</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">lapis</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Application</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_comment">-- the following two have the same effect with the default views_prefix</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_string">&quot;/home1&quot;</span><span class="sh_operator">:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_tbl_key sh_regex">layout:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;my_layout&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

  </span><span class="sh_string">&quot;/home2&quot;</span><span class="sh_operator">:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_tbl_key sh_regex">layout:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;views.my_layout&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

  </span><span class="sh_comment">-- this doesn&#x27;t use a layout at all</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_string">&quot;/no_layout&quot;</span><span class="sh_operator">:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_tbl_key sh_regex">layout:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">false</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;No layout rendered!&quot;</span></code>
</pre>
</div>

</p>

<p>As demonstrated in the example, passing false will prevent any layout from
being rendered.</p>

<h2><a name="widget-methods" href="#widget-methods">Widget Methods</a></h2>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Widget</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_operator">).</span><span class="sh_identifier">Widget</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_keyword">import</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">from</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;lapis.html&quot;</span></code>
</pre>
</div>

</p>

<p>When sub-classing a widget, take care not to override these methods if you don&rsquo;t
intend to change the default behavior.</p>

<h3><a name="widget-methods/Widget:extend" href="#widget-methods/Widget:extend"><code>Widget:extend([name], fields={}, [setup_fn])</code></a></h3>

<p>Creates a new subclass of the <code>Widget</code> base class. The <code>fields</code> argument is a
table of properties that will be copied into the instance metatable of the
newly created class, or it can be a function and it willl be set as the
<code>content</code> field.</p>

<p><code>name</code> is not directly used by Lapis but it can be helpful to provide it for
debugging and for implementing systems that derive details about the rendred
output based on the name of the widget (eg. automatically generated a class
based on the widget&rsquo;s name)</p>

<p><code>setup_fn</code> is an optional function that will be called with the class object as
the only argument. This function is called after properties have been set but
before any <code>__inherited</code> callbacks are called. The default <code>Widget</code> class does
not have any <code>__inherited</code> callbacks so it is not necessary to use this
function unless you specifically need that behavior for a subclass you have
created.</p>

<p>This method returns the newly created class object, followed by the instance
metatable.</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">SomeWidget</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Widget</span><span class="sh_operator">:</span><span class="sh_identifier">extend</span><span class="sh_operator">(</span><span class="sh_keyword">function</span><span class="sh_operator">(</span><span class="sh_identifier">self</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">return</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">div</span><span class="sh_operator">(</span><span class="sh_string">&quot;Hello world!&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_function">print</span><span class="sh_operator">(</span><span class="sh_identifier">SomeWidget</span><span class="sh_operator">():</span><span class="sh_identifier">render_to_string</span><span class="sh_operator">())</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_proper_ident sh_class">SomeWidget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_operator">\</span><span class="sh_library sh_type">extend</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello world!&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_function">print</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">SomeWidget</span><span class="sh_operator">!\</span><span class="sh_identifier">render_to_string</span><span class="sh_operator">!</span></code>
</pre>
</div>

</p>

<h3><a name="widget-methods/Widget" href="#widget-methods/Widget"><code>Widget([opts])</code></a></h3>

<p>The default constructor of the widget class will copy every field from the
<code>opts</code> argument to <code>self</code>, if the <code>opts</code> argument is provided. You can use this
to set render-time parameters or override methods.</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Widget</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_operator">).</span><span class="sh_identifier">Widget</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">SomeWidget</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">Widget</span><span class="sh_operator">:</span><span class="sh_identifier">extend</span><span class="sh_operator">({</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">content</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">(</span><span class="sh_identifier">self</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">div</span><span class="sh_operator">(</span><span class="sh_string">&quot;Hello &quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">self</span><span class="sh_operator">.</span><span class="sh_identifier">name</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">end</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">})</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">w</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">SomeWidget</span><span class="sh_operator">({</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">name</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Garf&quot;</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">})</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_function">print</span><span class="sh_operator">(</span><span class="sh_identifier">widget</span><span class="sh_operator">:</span><span class="sh_identifier">render_to_string</span><span class="sh_operator">())</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_comment">--&gt; &lt;div&gt;Hello Garf&lt;/div&gt;</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">SomeWidget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">html</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello &quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_self_ref sh_label">@name</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_identifier">widget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">SomeWidget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">name:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Garf&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_function">print</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">widget</span><span class="sh_operator">\</span><span class="sh_identifier">render_to_string</span><span class="sh_operator">!</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_comment">--&gt; &lt;div&gt;Hello Garf&lt;/div&gt;</span></code>
</pre>
</div>

</p>

<p>It is safe to override the constructor and not call <code>super</code> if you want to change
the initialization conditions of your widget.</p>

<h3><a name="widget-methods/Widget:include" href="#widget-methods/Widget:include"><code>Widget:include(other_class)</code></a></h3>

<p>Makes the methods and properties from another class available on the widget
class. This can be used to implement a form a multiple inheritance for sharing
code across many widgets without having to change the parent-class.</p>

<p>The argument <code>other_class</code> can either be a reference to a class, or a string.
If it&rsquo;s a string, it will be passed to <code>require</code>. The module should return a
class to be included.</p>

<pre class="highlight lang_moon"><code><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">MyHelpers</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">item_list:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_symbol sh_embedded">(</span><span class="sh_identifier">items</span><span class="sh_symbol sh_embedded">)</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">ul</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_keyword">for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">item</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">in</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">*</span><span class="sh_identifier">items</span><span class="sh_moonscript_whitespace sh_whitespace">
        </span><span class="sh_identifier">li</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">item</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">SomeWidget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_self_ref sh_label">@include</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">MyHelpers</span><span class="sh_moonscript_whitespace sh_whitespace">

  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_self_ref sh_label">@item_list</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_symbol sh_embedded">{</span><span class="sh_string">&quot;hello&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;world&quot;</span><span class="sh_symbol sh_embedded">}</span></code>
</pre>


<p>When including another class, the widget&rsquo;s class hierarchy is changed: A
dynamic <em>mixins</em> class is created exactly one level above the widget class.
This dynamically inserted class will contain all the copied fields from any
included classes. A widget will only ever have one mixins class created for it,
regardless of how many classes are included. The mixins class&rsquo;s parent class
will be the original parent class of the widget when it was first defined.</p>

<p>As an example, if given the following class hierarchy:</p>

<p><code>LoginPage &lt; Pages &lt; lapis.Widget</code></p>

<p>The first call to <code>include</code> within <code>LoginPage</code> will change the class hierarchy
to:</p>

<p><code>LoginPage &lt; LoginPageMixins &lt; Pages &lt; lapis.Widget</code></p>

<p>The dynamically inserted class <code>LoginPageMixins</code> will contain all the fields
copied from the included classes.</p>

<p>Because of this organization, the following hold true:</p>

<ul>
<li>Any methods or properties declared directly on the widget will take precedence over any fields in the mixins class.</li>
<li><code>super</code> can be used in the widget&rsquo;s methods to access overrided methods in the mixin class</li>
<li>The included class is able to use <code>super</code>, but it will point to the widget&rsquo;s original parent class, and not to a method in the hierarchy of the included class

<ul>
<li>If the included class is using inheritance, the hierarchy is flattened when fields are copied into the mixins class</li>
</ul>
</li>
<li>Because there is only one mixin class per widget class, if multiple included classes implement the same fields, they will be overwritten by subsequent calls to <code>include</code>. It is not possible to access overwritten properties</li>
</ul>


<p>The function <code>is_mixins_class</code> from the <code>lapis.html</code> module can be used to
determine if a class is a mixins class or not.</p>

<h3><a name="widget-methods/widget:render_to_string" href="#widget-methods/widget:render_to_string"><code>widget:render_to_string()</code></a></h3>

<p>Renders the <code>content</code> method of a widget and returns the string result. This
will automatically create a temporary buffer for the duration of the render.
This internally calls <code>widget.render()</code> with the temporary buffer.</p>

<p>Keep in mind that widgets must be executed in a special scope to enable the
HTML builder functions to work. It is not possible to call the <code>content</code> method
directly on the widget if you wish to render it, you must use this method.</p>

<h3><a name="widget-methods/widget:render" href="#widget-methods/widget:render"><code>widget:render(buffer, ...)</code></a></h3>

<p>Renders the <code>content</code> method of the widget to the provided buffer. Under normal
circumstances it is not necessary to use this method directly. However, it&rsquo;s
worth noting it exists to avoid accidentally overwriting the method when
sub-classing your own widgets.</p>

<p>This method returns nothing.</p>

<h3><a name="widget-methods/widget:content_for" href="#widget-methods/widget:content_for"><code>widget:content_for(name, [content])</code></a></h3>

<p><code>content_for</code> is used for sending HTML or strings from the view to the layout.
You've probably already seen <code>@content_for "inner"</code> if you've looked at
layouts. By default the content of the view is placed in the content block
called <code>"inner"</code>.</p>

<p>If <code>content_for</code> is called multiple times on the same <code>name</code>, the results will be
appended, not overwritten.</p>

<p>You can create arbitrary content blocks from the view by calling <code>@content_for</code>
with a name and some content:</p>

<pre class="highlight lang_moon"><code><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">MyView</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_self_ref sh_label">@content_for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;title&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;This is the title of my page!&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

    </span><span class="sh_self_ref sh_label">@content_for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;footer&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;custom_footer&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;The Footer&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
</span></code>
</pre>


<p>You can use either strings or builder functions as the content.</p>

<p>To access the content from the layout, call <code>@content_for</code> without the content
argument:</p>

<pre class="highlight lang_moon"><code><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">MyLayout</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">html</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_identifier">body</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
        </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;title&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
          </span><span class="sh_self_ref sh_label">@content_for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;title&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

        </span><span class="sh_self_ref sh_label">@content_for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;inner&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
        </span><span class="sh_self_ref sh_label">@content_for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;footer&quot;</span></code>
</pre>


<p>If a string is used as the value of a content block then it will be escaped
before written to the buffer. If you want to insert a raw string then you can
use a builder function in conjunction with the <code>raw</code> function:</p>

<pre class="highlight lang_moon"><code><span class="sh_self_ref sh_label">@content_for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;footer&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_identifier">raw</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;&lt;pre&gt;this wont&#x27; be escaped&lt;/pre&gt;&quot;</span></code>
</pre>


<h3><a name="widget-methods/widget:has_content_for" href="#widget-methods/widget:has_content_for"><code>widget:has_content_for(name)</code></a></h3>

<p>Checks to see if content for <code>name</code> is set.</p>

<pre class="highlight lang_moon"><code><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">MyView</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_keyword">if</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_self_ref sh_label">@has_content_for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;things&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_self_ref sh_label">@content_for</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;things&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_keyword">else</span><span class="sh_moonscript_whitespace sh_whitespace">
      </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
        </span><span class="sh_identifier">text</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;default content&quot;</span></code>
</pre>


<h2><a name="html-module" href="#html-module">HTML Module</a></h2>

<pre class="highlight lang_moon"><code><span class="sh_identifier">html</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;lapis.html&quot;</span></code>
</pre>


<h3><a name="html-module/html.Widget" href="#html-module/html.Widget"><code>html.Widget</code></a></h3>

<p>The Widget base class for creating templates in code as a class. See the <a href="#html-widgets">HTML
Widgets</a> for a full guide on using the Widget class.</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">html</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">IndexPage</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">html</span><span class="sh_operator">.</span><span class="sh_identifier">Widget</span><span class="sh_operator">:</span><span class="sh_identifier">extend</span><span class="sh_operator">(</span><span class="sh_string">&quot;IndexPage&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">content</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">(</span><span class="sh_identifier">self</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">div</span><span class="sh_operator">(</span><span class="sh_string">&quot;Hello!&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">end</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">})</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_keyword">import</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">from</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">IndexPage</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello!&quot;</span></code>
</pre>
</div>

</p>

<h3><a name="html-module/html.render_html" href="#html-module/html.render_html"><code>html.render_html(fn)</code></a></h3>

<p>Runs the function, <code>fn</code> in the HTML rendering context as described above.
Returns the resulting HTML as a string.</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_keyword">local</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_identifier">html</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_operator">(</span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">

</span><span class="sh_function">print</span><span class="sh_operator">(</span><span class="sh_identifier">html</span><span class="sh_operator">.</span><span class="sh_identifier">render_html</span><span class="sh_operator">(</span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">div</span><span class="sh_operator">({</span><span class="sh_identifier">class</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_string">&quot;item&quot;</span><span class="sh_operator">},</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">function</span><span class="sh_operator">()</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">strong</span><span class="sh_operator">(</span><span class="sh_string">&quot;Hello!&quot;</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_keyword">end</span><span class="sh_operator">)</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_keyword">end</span><span class="sh_operator">))</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_comment">--&gt; &lt;div class=&quot;item&quot;&gt;&lt;strong&gt;Hello!&lt;/strong&gt;&lt;/div&gt;</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_keyword">import</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">render_html</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">from</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_function">print</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">render_html</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">class:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;item&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">-&gt;</span><span class="sh_moonscript_whitespace sh_whitespace">
    </span><span class="sh_identifier">strong</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;Hello!&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_comment">--&gt; &lt;div class=&quot;item&quot;&gt;&lt;strong&gt;Hello!&lt;/strong&gt;&lt;/div&gt;</span></code>
</pre>
</div>

</p>

<h3><a name="html-module/html.escape" href="#html-module/html.escape"><code>html.escape(str)</code></a></h3>

<p>Escapes any HTML special characters in the string. The following are escaped:</p>

<ul>
<li><code>&amp;</code> &mdash; <code>&amp;amp;</code></li>
<li><code>&lt;</code> &mdash; <code>&amp;lt;</code></li>
<li><code>&gt;</code> &mdash; <code>&amp;gt;</code></li>
<li><code>"</code> &mdash; <code>&amp;quot;</code></li>
<li><code>'</code> &mdash; <code>&amp;#039;</code></li>
</ul>


<h3><a name="html-module/html.classnames" href="#html-module/html.classnames"><code>html.classnames(t)</code></a></h3>

<p>Converts a nested Lua table into a HTML class attribute string. Passing a
string to this function will return the string unmodified.</p>

<p>This function is applied to the value of the class attribute when using the
HTML builder syntax.</p>

<p><div class="dual_code">
<div class="dual_code_tabs">
        <button type="button" data-lang="lua" class="set_language">Lua</button>
        <button type="button" data-lang="moonscript" class="set_language">MoonScript</button>
      </div>
<pre class="highlight lang_lua"><code><span class="sh_identifier">classnames</span><span class="sh_operator">({</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_string">&quot;one&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_string">&quot;two&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_identifier">yes</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_operator">{</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">skipped</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">false</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_identifier">haveit</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_string">&quot;&quot;</span><span class="sh_operator">,</span><span class="sh_lua_whitespace sh_whitespace">
    </span><span class="sh_string">&quot;last&quot;</span><span class="sh_lua_whitespace sh_whitespace">
  </span><span class="sh_operator">}</span><span class="sh_lua_whitespace sh_whitespace">
</span><span class="sh_operator">})</span><span class="sh_lua_whitespace sh_whitespace"> </span><span class="sh_comment">--&gt; &quot;one two yes haveit last&quot;</span></code>
</pre>
<pre class="highlight lang_moon"><code><span class="sh_identifier">classnames</span><span class="sh_symbol sh_embedded">({</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_string">&quot;one&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_string">&quot;two&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">yes:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_symbol sh_embedded">{</span><span class="sh_tbl_key sh_regex">skipped:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">false</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_tbl_key sh_regex">haveit:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">true</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;&quot;</span><span class="sh_operator">,</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;last&quot;</span><span class="sh_symbol sh_embedded">}</span><span class="sh_moonscript_whitespace sh_whitespace">
</span><span class="sh_symbol sh_embedded">})</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_comment">--&gt; &quot;one two yes haveit last&quot;</span></code>
</pre>
</div>

</p>

<h3><a name="html-module/html.is_mixins_class" href="#html-module/html.is_mixins_class"><code>html.is_mixins_class(obj)</code></a></h3>

<p>Returns <code>true</code> if the argument <code>obj</code> is an auto-generated mixin class that
is inserted into the class hierarchy of a widget when <code>Widget:include</code> is
called.</p>

<pre class="highlight lang_moon"><code><span class="sh_identifier">html</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_operator">=</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_function">require</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;lapis.html&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">MyHelpers</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">say_hi:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">div</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_string">&quot;hi&quot;</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_keyword">class</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">SomeWidget</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_keyword">extends</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">html</span><span class="sh_operator">.</span><span class="sh_proper_ident sh_class">Widget</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_self_ref sh_label">@include</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_proper_ident sh_class">MyHelpers</span><span class="sh_moonscript_whitespace sh_whitespace">
  </span><span class="sh_tbl_key sh_regex">content:</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_fndef sh_preprocessor">=&gt;</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_self_ref sh_label">@say_hi</span><span class="sh_operator">!</span><span class="sh_moonscript_whitespace sh_whitespace">

</span><span class="sh_function">print</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_identifier">html</span><span class="sh_operator">.</span><span class="sh_identifier">is_mixins_class</span><span class="sh_symbol sh_embedded">(</span><span class="sh_proper_ident sh_class">SomeWidget</span><span class="sh_operator">.</span><span class="sh_identifier">__parent</span><span class="sh_symbol sh_embedded">)</span><span class="sh_moonscript_whitespace sh_whitespace"> </span><span class="sh_comment">--&gt; true</span><span class="sh_moonscript_whitespace sh_whitespace">
</span></code>
</pre>


      </div>
    </div>

  </div>

  <script src="../lib/jquery.min.js"></script>
  <script src="../lib/react.production.min.js"></script>
  <script src="../lib/react-dom.production.min.js"></script>
  <script src="../lib/react-dom-factories.js"></script>
  <script src="../lib/lunr.min.js"></script>
  <script type="text/javascript" src="../search.js?Wed Jan  4 22:57:36 2023"></script>
  <script type="text/javascript" src="../reference.js?Wed Jan  4 22:57:36 2023"></script>
  <script type="text/javascript">
    new L.Reference();
  </script>
</body>
</html>
